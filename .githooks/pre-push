#!/bin/bash

# Pre-push hook to verify code quality before pushing

set -e

# Force output to be visible (no buffering)
exec 1>&2

echo ""
echo "=========================================="
echo "üîç Running pre-push verification..."
echo "=========================================="
echo ""

# Check if Go is installed
if ! command -v go &> /dev/null; then
    echo "‚ùå Error: Go is not installed or not in PATH"
    exit 1
fi

# Run go fmt to check formatting
echo ""
echo "üìù Checking code formatting (go fmt)..."
if ! go fmt ./...; then
    echo "‚ùå Error: Code formatting failed"
    exit 1
fi
echo "‚úì Formatting OK"

# Run go vet to check for errors
echo ""
echo "üîé Running static analysis (go vet)..."
if ! go vet ./... 2>&1; then
    echo "‚ùå Error: go vet found issues"
    exit 1
fi
echo "‚úì Static analysis OK"

# Check if code compiles
echo ""
echo "üî® Verifying code compiles..."
if ! go build ./... 2>&1; then
    echo "‚ùå Error: Code does not compile"
    exit 1
fi
echo "‚úì Compilation OK"

# Check for uncommitted changes (optional - just warning)
if [ -n "$(git status --porcelain)" ]; then
    echo ""
    echo "‚ö†Ô∏è  Warning: You have uncommitted changes"
    echo "   Consider committing or stashing them before pushing"
fi

echo ""
echo "=========================================="
echo "‚úÖ Pre-push verification passed!"
echo "=========================================="
exit 0

